@using eKorpa.ViewModels

@model ArtikalIndexVM


<form asp-action="Index" asp-controller="Artikal">
    <input name="querry" placeholder="npr: majica" />
    <button type="submit" class="btn btn-dark">Pretraži</button>
</form>
<a href="/ListaZelja/Detalji">Lista zelja</a>

<div id="containerArtikala" style="display: flex; justify-content: space-evenly; flex-wrap:wrap">
    @if (Model.rows.Count == 0)
    {
        <h1>Nema rezultata</h1>
    }
    @foreach (var item in Model.rows)
    {
        <div class="artikalCopy" style="border: double red 1px; width: 300px; margin:10px; cursor:pointer; text-align:center">
            <div onclick="OtvoriDetaljeArtikla(@item.ID)">
                <label> ID </label>
                <span>@item.ID</span> <br />
                <label> Naziv artikla </label>
                <span>@item.NazivArtikla</span><br />
                <label> Kategorija </label>
                <span>@item.Kategorija</span><br />
                <label> Slika</label>

                @if (item.Slika.Count == 0)
                {
                    <h1>Nema slike</h1>
                }

                @for (int i = 0; i < item.Slika.Count; i++)
                {
                    @if (item.Slika[i] != null && item.Thumbnail[i] == 1)
                    {
                        var base64 = Convert.ToBase64String(item.Slika[i]);
                        var imgsrc = string.Format("data:image/gif;base64,{0}", base64);
                        <img src="@imgsrc" alt="Alternate Text" /><br />
                    }
                }

                <label> Cijena artikla </label>
                <span>@item.Cijena</span><br />
            </div>
            <label> Naziv prodavača </label>
            <a href="/Profil/Index?KorisnikID=@item.ProdavacId">@item.ImeProdavaca</a><br />
            @if (User.IsInRole("Admin"))
            {
                <a href="/Artikal/Dodaj" class="btn btn-secondary">Dodaj</a>
                <a href="/Artikal/Dodaj?ArtikalID=@item.ID">Uredi</a>
                <a href="/Artikal/Obrisi?ArtikalID=@item.ID">Obrisi</a><br />
            }
            @if (item.jestUListi)
            {
                <a id="srce" href="/ListaZelja/Provjeri?ArtikalID=@item.ID">Pretraži listu želja</a>
            }
            else
            {
                <a id="srce" href="/ListaZelja/Provjeri?ArtikalID=@item.ID" onclick="klik()">Dodaj na listu želja</a>
            }
        </div>
    }
</div>
<div id="yith-wcwl-popup-message" style="margin-left: -298px; display: none;"><div id="yith-wcwl-message">Dodali ste artikl na listu želja!</div></div>
@if (User.IsInRole("Admin"))
{
    <a href="/Artikal/Dodaj" class="btn btn-secondary">Dodaj</a>
}

<style>
    body {
        background-color: rgb(45,45,45);
        color: lightcoral;
    }

        body a {
            color: lightblue;
        }

    img {
        width: 200px;
    }
    #yith-wcwl-popup-message {
        background: #fff;
        border: 1px solid #dddddd;
        padding: 15px 0;
        font-size: 120%;
        position: fixed;
        text-align: center;
        top: 50%;
        left: 50%;
        transform: translateX(50%);
        width: 300px;
        z-index: 10000;
        margin-left: -298px;
        display: none;
    }

</style>

<script>
    function OtvoriProfilProdavaca(prodavacID) {
        var url = "/Profil/Index?KorisnikID=" + prodavacID;
        window.open(url, '_self');
    }

    function OtvoriDetaljeArtikla(artikalID) {
        var url = "/Artikal/Detalji?ArtikalID=" + artikalID;
        window.open(url, '_self');
    }
    function klik() { document.getElementById("yith-wcwl-popup-message").style.display = "block";}
            //function addRowHandlers() {
            //    var table = document.getElementById("containerArtikala");
            //    var rows = table.getElementsByTagName("artikalCopy");
            //    for (i = 0; i < rows.length; i++) {
            //        var currentRow = table.rows[i];
            //        var createClickHandler = function (row) {
            //            return function () {
            //                //var cell = row.getElementsByTagName("td")[0];
            //                var id = currentRow.innerHTML;
            //                url = "/Artikal/Detalji?ArtikalID=" + id;
            //                window.open(url, '_self');
            //            };
            //        };
            //        currentRow.onclick = createClickHandler(currentRow);
            //    }
            //}
            //window.onload = addRowHandlers();
</script>